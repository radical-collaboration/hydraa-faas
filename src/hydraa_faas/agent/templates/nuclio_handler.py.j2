#!/usr/bin/env python3
import json

# User-defined handler function
{{ handler_code }}

def handler(context, event):
    """Nuclio handler function"""
    try:
        # Get the request body
        body = event.body
        
        # Parse the payload
        if body:
            try:
                if isinstance(body, bytes):
                    body = body.decode('utf-8')
                payload = json.loads(body) if body.strip() else {}
            except (json.JSONDecodeError, UnicodeDecodeError):
                payload = body if body else {}
        else:
            payload = {}
        
        # Call user handler
        result = handle(payload)
        
        # Return response directly (new Nuclio style)
        return result
        
    except Exception as e:
        context.logger.error(f"Handler error: {str(e)}")
        return {"error": str(e), "type": type(e).__name__}
